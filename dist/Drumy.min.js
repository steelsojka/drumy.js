/**
 * Drumy.min.js v0.2.5
 *
 * A customizable drum pad console for triggering drum sounds.
 * @author Steven Sojka - Monday, February 18, 2013
 *
 * MIT Licensed
 */
(function(){var g,j=Array.prototype.indexOf||function(b){for(var a=0,e=this.length;a<e;a++)if(a in this&&this[a]===b)return a;return-1},k=Object.prototype.hasOwnProperty;g={};var f=function(){};f.prototype.on=function(b,a){var e,c,d,h,i;this._events||(this._events={});i=b.split(" ");d=0;for(h=i.length;d<h;d++)e=i[d],(c=this._events)[e]||(c[e]=[]),this._events[e].push(a)};f.prototype.off=function(b,a){var e,c,d,h;this._events||(this._events={});h=b.split(" ");c=0;for(d=h.length;c<d;c++)e=h[c],0>j.call(this._events,
e)||this._events[e].splice(this._events[e].indexOf(a),1)};f.prototype.emit=function(b){var a,e,c,d,h,i,f,g;this._events||(this._events={});f=b.split(" ");c=0;for(h=f.length;c<h;c++)if(e=f[c],e in this._events){g=this._events[e];d=0;for(i=g.length;d<i;d++)a=g[d],a.apply(this,[{type:e,target:this}].concat(Array.prototype.slice.call(arguments,1)))}};g.Event=f;g.Event.register=function(b){var a,e,c;c=g.Event.prototype;for(a in c)k.call(c,a)&&(e=c[a],b.prototype[a]=e)};this.Drumy=g}).call(this);
(function(){var g,j=Object.prototype.hasOwnProperty;g=function(b,a,e,c){-1!==b.note.indexOf(a)&&b.trigger(e,c)};var k=Drumy,f=function(b){var a;null==b&&(b={});this.context=b.context||new webkitAudioContext;this.pads=[];this.output=this.context.createGainNode();this.connectToMaster=!0;for(a in b)j.call(b,a)&&(this[a]=b[a]);this.connectToMaster&&this.connect(this.context.destination)};f.prototype.loadConfig=function(b){var a,e,c;c=b.pads;a=0;for(e=c.length;a<e;a++)b=c[a],this.addPad(b);return this};
f.prototype.save=function(){var b,a,e,c,d;c=this.pads;d=[];a=0;for(e=c.length;a<e;a++)b=c[a],d.push(b.save());return JSON.stringify({pads:d})};f.prototype.addPad=function(b){b||(b={});b.context=this.context;b=new Drumy.Pad(b);b.output.connect(this.output);this.pads.push(b);return b};f.prototype.removePad=function(b){0<=b&&b<this.pads.length&&this.pads[b].destroy();return this};f.prototype.getPad=function(b){if(0<=b&&b<this.pads.length)return this.pads[b]};f.prototype.connect=function(b){this.output.connect(b);
return this};f.prototype.stop=function(){var b,a,e,c,d,h,i;h=this.pads;a=0;for(c=h.length;a<c;a++){b=h[a];i=b.voices;e=0;for(d=i.length;e<d;e++)b=i[e],b.stop()}};f.prototype.getContext=function(){return this.context};f.prototype.trigger=function(b,a,e){var c,d,h,i;i=this.pads;d=0;for(h=i.length;d<h;d++)c=i[d],g(c,b,a,e);return this};k.Core=f;Drumy.create=function(b){return new Drumy.Core(b)};null!=Drumy.Event&&Drumy.Event.register(Drumy.Core)}).call(this);
(function(){var g,j,k;g=function(a,e,b){a.velocityMax>=e&&e>=a.velocityMin&&a.trigger(e,b)};j=function(){var a,b,c,d;d=this.voices;b=0;for(c=d.length;b<c;b++)a=d[b],a.off("sampleStart sampleEnd",k.bind(this)),a.on("sampleStart sampleEnd",k.bind(this))};k=function(a){return this.emit(a.type,a.target)};var f=Drumy,b=function(a){var b,c,d;null==a&&(a={});this.voices=[];this.note=[];this.context=a.context;this.name=a.name||"Pad";Array.isArray(a.note)?this.note=this.note.concat(a.note):a.note?this.note.push(a.note):
this.note.push(32);this.output=this.context.createGainNode();if(a.voices){d=a.voices;b=0;for(c=d.length;b<c;b++)a=d[b],this.loadVoice(a)}};b.prototype.loadVoice=function(a){this.addVoice(a);return this};b.prototype.save=function(){var a,b=this.name,c=this.note,d,h,i,f;i=this.voices;f=[];d=0;for(h=i.length;d<h;d++)a=i[d],f.push(a.save());return{name:b,note:c,voices:f}};b.prototype.addVoice=function(a){null==a&&(a={});a.context=this.context;a.padOutput=this.output;a=new Drumy.Voice(a);this.voices.push(a);
j.call(this);return a};b.prototype.removeVoice=function(a){var b;0<=a&&a<this.voices.length&&(b=this.voices[a],a=this.voices.indexOf(b),b.destroy(),this.voices.splice(a,1));return this};b.prototype.getVoice=function(a){if(0<=a&&a<this.voices.length)return this.voices[a]};b.prototype.setNoteNumber=function(a){0<=a&&127>=a&&-1===this.note.indexOf(a)&&this.note.push(a);return this};b.prototype.removeNoteNumber=function(a){a=this.note.indexOf(a);if(-1!==a)return this.note.splice(a,1),this};b.prototype.setGain=
function(a){this.output.gain.value=a;return this};b.prototype.setName=function(a){this.name=a;return this};b.prototype.trigger=function(a,b){var c,d,h,f;f=this.voices;d=0;for(h=f.length;d<h;d++)c=f[d],g(c,a,b);return this};b.prototype.destroy=function(){var a,b,c,d;d=this.voices;b=0;for(c=d.length;b<c;b++)a=d[b],a.destroy()};f.Pad=b;null!=Drumy.Event&&Drumy.Event.register(Drumy.Pad)}).call(this);
(function(){var g,j;g=function(a,b){var c;c=new XMLHttpRequest;c.open("GET",a);c.responseType="arraybuffer";c.onload=b;return c.send()};j=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};var k=function(a,b,c,d,f,i,g,k,j,l,m){this.context=g;this.offset=c;this.callback=l;this.source=g.createBufferSource();this.gainNode=g.createGainNode();this.source.buffer=a;this.source.connect(this.gainNode);this.gainNode.connect(i);this.onTriggerCallback=m;this.trigger(b,d,f,k);this.voice=j;j.on("stop",this.stop.bind(this))};
k.prototype.trigger=function(a,b,c,d){null==d&&(d=this.context.currentTime);this.source.start(d+this.offset);this.gainNode.gain.value=a/127;this.onTriggerTimeout=setTimeout(this.onTriggerCallback,1E3*(d-this.context.currentTime+this.offset));this.onDestroyTimeout=setTimeout(this.destroy.bind(this),1E3*(this.source.buffer.duration+this.offset+(d-this.context.currentTime)))};k.prototype.stop=function(){clearTimeout(this.onTriggerTimeout);clearTimeout(this.onDestroyTimeout);this.source.disconnect(0);
return this.gainNode.disconnect(0)};k.prototype.destroy=function(){this.stop();this.callback()};var f=Drumy,b=function(a){var b,c,d;null==a&&(a={});this.velocityMax=a.velocityMax||127;this.velocityMin=a.velocityMin||0;this.offset=a.offset||0;this.alternateRate=null!=a.alternateRate?a.alternateRate:0.25;this.context=a.context;this.alternates=[];this.padOutput=a.padOutput;this.url=a.url||"";this.gain=a.gain||1;this.onTriggerTimeouts=[];this.output=this.context.createGainNode();this.output.connect(this.padOutput);
a.gain&&this.setGain(a.gain);a.url&&this.loadFromUrl(a.url);this.buffer&&this.loadBuffer(this.buffer);if(a.alternates){d=a.alternates;a=0;for(c=d.length;a<c;a++)b=d[a],b.context=this.context,b.padOutput=this.padOutput,b=new Drumy.Voice(b),b.on("sampleStart",this.onTrigger.bind(this)),b.on("sampleEnd",this.onSampleDestroy.bind(this)),this.alternates.push(b)}};b.prototype.save=function(){var a,b=this.url,c=this.gain,d=this.velocityMin,f=this.velocityMax,g=this.offset,k=this.alternateRate,j,n,l,m;l=
this.alternates;m=[];j=0;for(n=l.length;j<n;j++)a=l[j],m.push(a.save());return{url:b,gain:c,velocityMin:d,velocityMax:f,offset:g,alternateRate:k,alternates:m}};b.prototype.loadFromUrl=function(a,b){var c=this;g(a,function(a){c.context.decodeAudioData(a.currentTarget.response,function(a){c.loadBuffer(a);"function"===typeof b&&b()})});return this};b.prototype.loadBuffer=function(a){this.buffer=Array.isArray(a)?this.context.createBuffer(2,a[0].length,this.context.sampleRate):a;return this};b.prototype.onTrigger=
function(){return this.emit("sampleStart")};b.prototype.trigger=function(a,b){Math.random()<this.alternateRate&&0<this.alternates.length?this.alternates[j(0,this.alternates.length-1)].trigger(a):new k(this.buffer,a,this.offset,this.velocityMin,this.velocityMax,this.output,this.context,b,this,this.onSampleDestroy.bind(this),this.onTrigger.bind(this));return this};b.prototype.onSampleDestroy=function(){return this.emit("sampleEnd")};b.prototype.setVelocityMax=function(a){this.velocityMin<a&&127>=a&&
(this.velocityMax=a);return this};b.prototype.setVelocityMin=function(a){0<=a&&a<this.velocityMax&&(this.velocityMin=a);return this};b.prototype.setGain=function(a){this.output.gain.value=a;return this};b.prototype.setOffset=function(a){this.offset=a;return this};b.prototype.getDuration=function(){return this.buffer.duration};b.prototype.stop=function(){return this.emit("stop")};b.prototype.destroy=function(){return this.output.disconnect(0)};f.Voice=b;null!=Drumy.Event&&Drumy.Event.register(Drumy.Voice)}).call(this);
