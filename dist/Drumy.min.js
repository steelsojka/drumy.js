/**
 * Drumy.min.js v0.1
 *
 * A customizable drum pad console for trigger drum sounds
 * @author Steven Sojka - Tuesday, February 12, 2013
 *
 * MIT Licensed
 */
(function(){var d,f,b=Object.prototype.hasOwnProperty;d={};f=function(a,c,e){a.note===c&&a.trigger(e)};var a=function(a){var c;null==a&&(a={});this.context=a.context||new webkitAudioContext;this.pads=[];this.output=this.context.createGainNode();this.connectToMaster=!0;for(c in a)b.call(a,c)&&(this[c]=a[c]);this.connectToMaster&&this.connect(this.context.destination)};a.prototype.loadConfig=function(a){var c,e,b;b=a.pads;c=0;for(e=b.length;c<e;c++)a=b[c],this.addPad(a);return this};a.prototype.addPad=
function(a){a||(a={});a.context=this.context;a=new d.Pad(a);a.output.connect(this.output);this.pads.push(a);return a};a.prototype.removePad=function(a){0<=a&&a<this.pads.length&&this.pads[a].destroy();return this};a.prototype.getPad=function(a){if(0<=a&&a<this.pads.length)return this.pads[a]};a.prototype.connect=function(a){this.output.connect(a);return this};a.prototype.getContext=function(){return this.context};a.prototype.trigger=function(a,c){var b,d,i,g;g=this.pads;d=0;for(i=g.length;d<i;d++)b=
g[d],f(b,a,c);return this};d.Core=a;d.create=function(a){return new d.Core(a)};this.Drumy=d}).call(this);
(function(){var d;d=function(a,b){a.velocityMax>=b&&b>=a.velocityMin&&a.trigger(b)};var f=Drumy,b=function(a){var b,c,e;null==a&&(a={});this.voices=[];this.context=a.context;this.note=a.note||32;this.name=a.name||"Pad";this.output=this.context.createGainNode();if(a.voices){e=a.voices;b=0;for(c=e.length;b<c;b++)a=e[b],this.loadVoice(a)}};b.prototype.loadVoice=function(a){this.addVoice({url:a.url,velocityMin:a.vMin,velocityMax:a.vMax,gain:1,offset:a.offset});return this};b.prototype.addVoice=function(a){null==
a&&(a={});a.context=this.context;a.padOutput=this.output;a=new Drumy.Voice(a);this.voices.push(a);return a};b.prototype.removeVoice=function(a){var b;0<=a&&a<this.voices.length&&(b=this.voices[a],a=this.voices.indexOf(b),b.destroy(),this.voices.splice(a,1));return this};b.prototype.getVoice=function(a){if(0<=a&&a<this.voices.length)return this.voices[a]};b.prototype.setNoteNumber=function(a){0<=a&&127>=a&&(this.note=a);return this};b.prototype.setGain=function(a){this.output.gain.value=a;return this};
b.prototype.setName=function(a){this.name=a;return this};b.prototype.trigger=function(a){var b,c,e,h;h=this.voices;c=0;for(e=h.length;c<e;c++)b=h[c],d(b,a);return this};b.prototype.destroy=function(){var a,b,c,e;e=this.voices;b=0;for(c=e.length;b<c;b++)a=e[b],a.destroy()};f.Pad=b}).call(this);
(function(){var d=function(a,b,c,e,d,f,g){this.context=g;this.offset=c;this.source=g.createBufferSource();this.gainNode=g.createGainNode();this.source.buffer=a;this.source.connect(this.gainNode);this.gainNode.connect(f);this.trigger(b,e,d)};d.prototype.trigger=function(a){this.source.start(this.context.currentTime+this.offset);this.gainNode.gain.value=a/127;setTimeout(this.destroy.bind(this),1E3*(this.source.buffer.duration+this.offset))};d.prototype.destroy=function(){this.source.disconnect(0);this.gainNode.disconnect(0)};
var f=Drumy,b=function(){this.velocityMax=options.velocityMax||127;this.velocityMin=options.velocityMin||0;this.offset=options.offset||0;this.context=options.context;this.padOutput=options.padOutput;this.output=this.context.createGainNode();this.output.connect(this.padOutput);options.gain&&this.setGain(options.gain);options.url&&this.loadFromUrl(options.url);this.buffer&&this.loadBuffer(this.buffer)};b.prototype.loadFromUrl=function(a,b){var c,d=this;c=new XMLHttpRequest;c.open("GET",a);c.responseType=
"arraybuffer";c.onload=function(a){d.context.decodeAudioData(a.currentTarget.response,function(a){d.loadBuffer(a);"function"===typeof b&&b()})};c.send();return this};b.prototype.loadBuffer=function(a){this.buffer=Array.isArray(a)?this.context.createBuffer(2,a[0].length,this.context.sampleRate):a;return this};b.prototype.trigger=function(a){new d(this.buffer,a,this.offset,this.velocityMin,this.velocityMax,this.output,this.context);return this};b.prototype.setVelocityMax=function(a){this.velocityMin<
a&&127>=a&&(this.velocityMax=a);return this};b.prototype.setVelocityMin=function(a){0<=a&&a<this.velocityMax&&(this.velocityMin=a);return this};b.prototype.setGain=function(a){this.output.gain.value=a;return this};b.prototype.setOffset=function(a){this.offset=a;return this};b.prototype.destroy=function(){return this.output.disconnect(0)};f.Voice=b}).call(this);
