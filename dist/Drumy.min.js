/**
 * Drumy.min.js v0.2.3
 *
 * A customizable drum pad console for triggering drum sounds.
 * @author Steven Sojka - Thursday, February 14, 2013
 *
 * MIT Licensed
 */
(function(){var g,i=Array.prototype.indexOf||function(b){for(var a=0,f=this.length;a<f;a++)if(a in this&&this[a]===b)return a;return-1},h=Object.prototype.hasOwnProperty;g={};var e=function(){};e.prototype.on=function(b,a){var f,c,d,j,k;this._events||(this._events={});k=b.split(" ");d=0;for(j=k.length;d<j;d++)f=k[d],(c=this._events)[f]||(c[f]=[]),this._events[f].push(a)};e.prototype.off=function(b,a){var f,c,d,j;this._events||(this._events={});j=b.split(" ");c=0;for(d=j.length;c<d;c++)f=j[c],0>i.call(this._events,
f)||this._events[f].splice(this._events[f].indexOf(a),1)};e.prototype.emit=function(b){var a,f,c,d,j,k,e,g;this._events||(this._events={});e=b.split(" ");c=0;for(j=e.length;c<j;c++)if(f=e[c],f in this._events){g=this._events[f];d=0;for(k=g.length;d<k;d++)a=g[d],a.apply(this,[{type:f,target:this}].concat(Array.prototype.slice.call(arguments,1)))}};g.Event=e;g.Event.register=function(b){var a,f,c;c=g.Event.prototype;for(a in c)h.call(c,a)&&(f=c[a],b.prototype[a]=f)};this.Drumy=g}).call(this);
(function(){var g,i=Object.prototype.hasOwnProperty;g=function(b,a,f,c){-1!==b.note.indexOf(a)&&b.trigger(f,c)};var h=Drumy,e=function(b){var a;null==b&&(b={});this.context=b.context||new webkitAudioContext;this.pads=[];this.output=this.context.createGainNode();this.connectToMaster=!0;for(a in b)i.call(b,a)&&(this[a]=b[a]);this.connectToMaster&&this.connect(this.context.destination)};e.prototype.loadConfig=function(b){var a,f,c;c=b.pads;a=0;for(f=c.length;a<f;a++)b=c[a],this.addPad(b);return this};
e.prototype.save=function(){var b,a,f,c,d;c=this.pads;d=[];a=0;for(f=c.length;a<f;a++)b=c[a],d.push(b.save());return JSON.stringify({pads:d})};e.prototype.addPad=function(b){b||(b={});b.context=this.context;b=new Drumy.Pad(b);b.output.connect(this.output);this.pads.push(b);return b};e.prototype.removePad=function(b){0<=b&&b<this.pads.length&&this.pads[b].destroy();return this};e.prototype.getPad=function(b){if(0<=b&&b<this.pads.length)return this.pads[b]};e.prototype.connect=function(b){this.output.connect(b);
return this};e.prototype.getContext=function(){return this.context};e.prototype.trigger=function(b,a,f){var c,d,j,e;e=this.pads;d=0;for(j=e.length;d<j;d++)c=e[d],g(c,b,a,f);return this};h.Core=e;Drumy.create=function(b){return new Drumy.Core(b)};null!=Drumy.Event&&Drumy.Event.register(Drumy.Core)}).call(this);
(function(){var g,i,h;g=function(a,b,c){a.velocityMax>=b&&b>=a.velocityMin&&a.trigger(b,c)};i=function(){var a,b,c,d;d=this.voices;b=0;for(c=d.length;b<c;b++)a=d[b],a.off("sampleStart sampleEnd",h.bind(this)),a.on("sampleStart sampleEnd",h.bind(this))};h=function(a){return this.emit(a.type,a.target)};var e=Drumy,b=function(a){var b,c,d;null==a&&(a={});this.voices=[];this.note=[];this.context=a.context;this.name=a.name||"Pad";Array.isArray(a.note)?this.note=this.note.concat(a.note):a.note?this.note.push(a.note):
this.note.push(32);this.output=this.context.createGainNode();if(a.voices){d=a.voices;b=0;for(c=d.length;b<c;b++)a=d[b],this.loadVoice(a)}};b.prototype.loadVoice=function(a){this.addVoice(a);return this};b.prototype.save=function(){var a,b=this.name,c=this.note,d,e,g,h;g=this.voices;h=[];d=0;for(e=g.length;d<e;d++)a=g[d],h.push(a.save());return{name:b,note:c,voices:h}};b.prototype.addVoice=function(a){null==a&&(a={});a.context=this.context;a.padOutput=this.output;a=new Drumy.Voice(a);this.voices.push(a);
i.call(this);return a};b.prototype.removeVoice=function(a){var b;0<=a&&a<this.voices.length&&(b=this.voices[a],a=this.voices.indexOf(b),b.destroy(),this.voices.splice(a,1));return this};b.prototype.getVoice=function(a){if(0<=a&&a<this.voices.length)return this.voices[a]};b.prototype.setNoteNumber=function(a){0<=a&&127>=a&&-1===this.note.indexOf(a)&&this.note.push(a);return this};b.prototype.removeNoteNumber=function(a){a=this.note.indexOf(a);if(-1!==a)return this.note.splice(a,1),this};b.prototype.setGain=
function(a){this.output.gain.value=a;return this};b.prototype.setName=function(a){this.name=a;return this};b.prototype.trigger=function(a,b){var c,d,e,h;h=this.voices;d=0;for(e=h.length;d<e;d++)c=h[d],g(c,a,b);return this};b.prototype.destroy=function(){var a,b,c,d;d=this.voices;b=0;for(c=d.length;b<c;b++)a=d[b],a.destroy()};e.Pad=b;null!=Drumy.Event&&Drumy.Event.register(Drumy.Pad)}).call(this);
(function(){var g,i;g=function(a,b){var c;c=new XMLHttpRequest;c.open("GET",a);c.responseType="arraybuffer";c.onload=b;return c.send()};i=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};var h=function(a,b,c,d,e,g,h,i,l){this.context=h;this.offset=c;this.callback=l;this.source=h.createBufferSource();this.gainNode=h.createGainNode();this.source.buffer=a;this.source.connect(this.gainNode);this.gainNode.connect(g);this.trigger(b,d,e)};h.prototype.trigger=function(a){this.source.start(this.context.currentTime+
this.delay+this.offset);this.gainNode.gain.value=a/127;setTimeout(this.destroy.bind(this),1E3*(this.source.buffer.duration+this.offset))};h.prototype.destroy=function(){this.source.disconnect(0);this.gainNode.disconnect(0);this.callback()};var e=Drumy,b=function(a){var b,c,d;null==a&&(a={});this.velocityMax=a.velocityMax||127;this.velocityMin=a.velocityMin||0;this.offset=a.offset||0;this.alternateRate=null!=a.alternateRate?a.alternateRate:0.25;this.context=a.context;this.alternates=[];this.padOutput=
a.padOutput;this.url=a.url||"";this.gain=a.gain||1;this.output=this.context.createGainNode();this.output.connect(this.padOutput);a.gain&&this.setGain(a.gain);a.url&&this.loadFromUrl(a.url);this.buffer&&this.loadBuffer(this.buffer);if(a.alternates){d=a.alternates;b=0;for(c=d.length;b<c;b++)a=d[b],a.context=this.context,a.padOutput=this.padOutput,this.alternates.push(new Drumy.Voice(a))}};b.prototype.save=function(){var a,b=this.url,c=this.gain,d=this.velocityMin,e=this.velocityMax,g=this.offset,h=
this.alternateRate,i,l,m,n;m=this.alternates;n=[];i=0;for(l=m.length;i<l;i++)a=m[i],n.push(a.save());return{url:b,gain:c,velocityMin:d,velocityMax:e,offset:g,alternateRate:h,alternates:n}};b.prototype.loadFromUrl=function(a,b){var c=this;g(a,function(a){c.context.decodeAudioData(a.currentTarget.response,function(a){c.loadBuffer(a);"function"===typeof b&&b()})});return this};b.prototype.loadBuffer=function(a){this.buffer=Array.isArray(a)?this.context.createBuffer(2,a[0].length,this.context.sampleRate):
a;return this};b.prototype.trigger=function(a,b){this.emit("sampleStart");Math.random()<this.alternateRate&&0<this.alternates.length?this.alternates[i(0,this.alternates.length-1)].trigger(a):new h(this.buffer,a,this.offset,this.velocityMin,this.velocityMax,this.output,this.context,b,this.onSampleDestroy.bind(this));return this};b.prototype.onSampleDestroy=function(){return this.emit("sampleEnd")};b.prototype.setVelocityMax=function(a){this.velocityMin<a&&127>=a&&(this.velocityMax=a);return this};
b.prototype.setVelocityMin=function(a){0<=a&&a<this.velocityMax&&(this.velocityMin=a);return this};b.prototype.setGain=function(a){this.output.gain.value=a;return this};b.prototype.setOffset=function(a){this.offset=a;return this};b.prototype.getDuration=function(){return this.buffer.duration};b.prototype.destroy=function(){return this.output.disconnect(0)};e.Voice=b;null!=Drumy.Event&&Drumy.Event.register(Drumy.Voice)}).call(this);
