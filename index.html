<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title></title>
  <script type="text/javascript" src="js/Drumy.Event.js"></script>
  <script type="text/javascript" src="js/Drumy.Core.js"></script>
  <script type="text/javascript" src="js/Drumy.Pad.js"></script>
  <script type="text/javascript" src="js/Drumy.Voice.js"></script>
  <script type="text/javascript" src="js/Drumy.UI.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
  <script src="https://bitbucket.org/steelsojka/jmid.js/raw/cab87e7925f441819c00536cc7b4b78d595a2ed6/dist/jMID.min.js"></script>
  <link rel="stylesheet" href="src/ui/Drumy.UI.css">
  <style>
    #container {
      width: 800px;
      height: 800px;
    }
  </style>
</head>
<body>
  <section id="container"></section>
  <input type="file"></input>

  <script type="text/javascript">
    var handleChange = function(e) {
      var files = e.target.files;
      var reader = new FileReader();

      reader.onload = function(e) {
        window.context = new webkitAudioContext();
        window.stream = new jMID.Stream(e.target.result);
        window.decoder = new jMID.Decoder();
        window.file = decoder.decode(stream);
        window.player = new jMID.Player({
          file : file,
          context : context
        });

        player.on('event', function(e) {
          if (e.subtype === "noteOn") {
            drums.trigger(e.noteNumber, e.velocity)
          }
        });
      };

      reader.readAsBinaryString(files[0]);
    };

    $(function() {
      window.drums = Drumy.create();
      Drumy.UI.initialize();

      $.get('src/patches/9pad.json', function(e) {
          drums.loadConfig(e);
          drums.render("#container");
      });

      document.querySelector('input').addEventListener('change', handleChange, false);
    });
  </script>
</body>
</html>